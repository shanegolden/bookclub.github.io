<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Book Club Home</title>
<link rel="stylesheet" href="./components/navbar.css" />
<style>
  body { font-family: Arial, sans-serif; background: #f5f6fa; margin:0; padding:0; padding-top:80px; }
  .container { max-width:600px; margin:2rem auto; padding:1rem; background:white; border-radius:8px; box-shadow:0 2px 10px rgba(0,0,0,0.1); }
  .submission-card { display:flex; flex-direction:column; align-items:center; margin:1rem 0; background:#f0f4f8; padding:1rem; border-radius:8px; }
  .submission-card img.book-cover { width:150px; height:220px; object-fit:cover; border-radius:5px; }
  .book-info { text-align:center; margin-top:0.5rem; }
  .winner-display { margin-top:1rem; font-weight:bold; font-size:1.2rem; color:green; }
</style>
</head>
<body>

<!-- Navbar container -->
<div id="navbar"></div>

<!-- Home content -->
<div class="container">
  <h2>Most Recent Winning Book</h2>
  <div id="winnerDisplay" class="winner-display">Loading...</div>
</div>

<!-- Navbar JS -->
<script type="module">
import { loadNavbar } from './components/load-navbar.js';
loadNavbar("Home", false); // Home active, no admin menu
</script>

<!-- Firebase + Winner Fetch JS -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

// Firebase config (same as dashboard)
const firebaseConfig = { 
  apiKey:"AIzaSyARFfiXUa27jTt2nfuStSGZL4HCCp5oPx0", 
  authDomain:"book-club-f42b1.firebaseapp.com", 
  projectId:"book-club-f42b1", 
  storageBucket:"book-club-f42b1.appspot.com", 
  messagingSenderId:"85630091573", 
  appId:"1:85630091573:web:427077f1351140fc278c7c" 
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

async function loadWinner() {
  const container = document.getElementById("winnerDisplay");
  try {
    const winnerDoc = await getDoc(doc(db, "public", "winner"));
    if(!winnerDoc.exists()) {
      container.innerText = "No winner yet";
      return;
    }
    const winner = winnerDoc.data();

    const div = document.createElement("div");
    div.className = "submission-card";
    div.innerHTML = `
      <img src="${winner.coverUrl}" class="book-cover"/>
      <div class="book-info">
        <h3>${winner.title}</h3>
        <p><strong>Author:</strong> ${winner.author}</p>
        <p><strong>Year Published:</strong> ${winner.year}</p>
        <p><strong>Pages:</strong> ${winner.pages}</p>
        <p style="font-size:0.9rem;"><strong>Description:</strong> ${winner.description}</p>
        <p style="margin-top:0.5rem;"><strong>Votes:</strong> ${winner.votes}</p>
      </div>
    `;
    container.innerHTML = "";
    container.appendChild(div);
  } catch(err) {
    console.error("Error fetching public winner:", err);
    container.innerText = "Failed to load winner";
  }
}

// Load the winner on page load
loadWinner();
</script>

</body>
</html>
