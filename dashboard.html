<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Book Club Dashboard</title>

<!-- Navbar loader -->
<script type="module">
  import { loadNavbar } from '/js/navbar.js';
  loadNavbar("Dashboard"); // Sets the active page name in navbar
</script>

<style>
/* Keep existing styles intact */
body { font-family: Arial, sans-serif; background: #f5f6fa; margin:0; padding:0; }
button { padding:0.5rem 1rem; margin:0.2rem; cursor:pointer; border:none; border-radius:5px; }
button:hover { opacity:0.9; }
.btn-primary { background:#4a90e2; color:white; }
.btn-danger { background:#e94b3c; color:white; }
.container { max-width:900px; margin:2rem auto; padding:1rem; background:white; border-radius:8px; box-shadow:0 2px 10px rgba(0,0,0,0.1); }
input { padding:0.5rem; width:100%; margin:0.5rem 0; border-radius:5px; border:1px solid #ccc; }
.submission-card { display:flex; gap:1rem; margin:1rem 0; background:#f0f4f8; padding:0.5rem; border-radius:8px; transition: transform 0.2s ease; }
.submission-card:hover { transform: translateY(-2px); }
.submission-card img.book-cover { width:120px; height:180px; object-fit:cover; border-radius:5px; }
.book-info { flex:1; display:flex; flex-direction:column; justify-content:space-between; }
.book-actions { margin-top:0.5rem; display:flex; gap:0.5rem; flex-wrap:wrap; }
.my-submissions { margin-top:2rem; }
h2 { border-bottom:1px solid #ccc; padding-bottom:0.5rem; }
.match-options { display:flex; flex-wrap:wrap; gap:1rem; margin-top:1rem; }
.match-options .submission-card { width:200px; flex-direction:column; align-items:center; }
.match-options .book-info { align-items:center; text-align:center; }
.vote-info { margin-top:0.5rem; color:#333; }
.winner-display { margin-top:1rem; font-weight:bold; font-size:1.2rem; color:green; }
</style>
</head>
<body>

<!-- Navbar will be injected here by loadNavbar() -->

<div class="container">
  <h2 id="sectionTitle">Submit a Book</h2>
  <div id="submissionForm">
    <input id="bookTitle" placeholder="Book Title" />
    <input id="bookAuthor" placeholder="Author Name" />
    <button id="submitBookBtn" class="btn-primary">Submit Book</button>
  </div>

  <div id="matchSelection" class="match-options"></div>
  <div id="winnerDisplay" class="winner-display"></div>

  <div class="my-submissions">
    <h2>My Submissions</h2>
    <div id="mySubmissionsList"></div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
import { getFirestore, collection, query, where, addDoc, getDocs, updateDoc, deleteDoc, doc, serverTimestamp, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

const firebaseConfig = { apiKey:"AIzaSyARFfiXUa27jTt2nfuStSGZL4HCCp5oPx0", authDomain:"book-club-f42b1.firebaseapp.com", projectId:"book-club-f42b1", storageBucket:"book-club-f42b1.appspot.com", messagingSenderId:"85630091573", appId:"1:85630091573:web:427077f1351140fc278c7c" };
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let currentUser = null;
let currentPeriod = null;

// Logout handled by navbar, fallback here
document.addEventListener("click", async e => {
  if(e.target.id === "logoutBtn") {
    await signOut(auth);
    window.location.href = "/login";
  }
});

// Auth + setup
onAuthStateChanged(auth, async (user) => {
  if(!user) return window.location.href="/login";
  currentUser = user;
  await setupSubmissionListener();
  await loadMySubmissions(); // always show history
});

// --- Rest of your dashboard JS (submission, voting, winner display, etc.) remains unchanged ---
</script>

</body>
</html>
